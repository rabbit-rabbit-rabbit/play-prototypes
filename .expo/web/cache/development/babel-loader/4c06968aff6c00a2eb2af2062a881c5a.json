{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importDefault(require(\"react\"));\n\nvar react_native_1 = require(\"react-native-web/dist/index\");\n\nvar react_native_gesture_handler_1 = require(\"react-native-gesture-handler\");\n\nvar react_native_reanimated_1 = __importDefault(require(\"react-native-reanimated\"));\n\nvar procs_1 = require(\"./procs\");\n\nvar AnimatedFlatList = react_native_reanimated_1.default.createAnimatedComponent(react_native_gesture_handler_1.FlatList);\nvar Value = react_native_reanimated_1.default.Value,\n    abs = react_native_reanimated_1.default.abs,\n    set = react_native_reanimated_1.default.set,\n    cond = react_native_reanimated_1.default.cond,\n    add = react_native_reanimated_1.default.add,\n    sub = react_native_reanimated_1.default.sub,\n    event = react_native_reanimated_1.default.event,\n    block = react_native_reanimated_1.default.block,\n    eq = react_native_reanimated_1.default.eq,\n    neq = react_native_reanimated_1.default.neq,\n    and = react_native_reanimated_1.default.and,\n    or = react_native_reanimated_1.default.or,\n    call = react_native_reanimated_1.default.call,\n    onChange = react_native_reanimated_1.default.onChange,\n    divide = react_native_reanimated_1.default.divide,\n    greaterThan = react_native_reanimated_1.default.greaterThan,\n    greaterOrEq = react_native_reanimated_1.default.greaterOrEq,\n    lessOrEq = react_native_reanimated_1.default.lessOrEq,\n    not = react_native_reanimated_1.default.not,\n    Clock = react_native_reanimated_1.default.Clock,\n    clockRunning = react_native_reanimated_1.default.clockRunning,\n    startClock = react_native_reanimated_1.default.startClock,\n    stopClock = react_native_reanimated_1.default.stopClock,\n    spring = react_native_reanimated_1.default.spring,\n    defined = react_native_reanimated_1.default.defined,\n    min = react_native_reanimated_1.default.min,\n    max = react_native_reanimated_1.default.max,\n    debug = react_native_reanimated_1.default.debug;\nvar scrollPositionTolerance = 2;\nvar defaultAnimationConfig = {\n  damping: 20,\n  mass: 0.2,\n  stiffness: 100,\n  overshootClamping: false,\n  restSpeedThreshold: 0.2,\n  restDisplacementThreshold: 0.2\n};\nvar defaultProps = {\n  autoscrollThreshold: 30,\n  autoscrollSpeed: 100,\n  animationConfig: defaultAnimationConfig,\n  scrollEnabled: true,\n  dragHitSlop: 0,\n  activationDistance: 0,\n  dragItemOverflow: false\n};\n\nfunction onNextFrame(callback) {\n  setTimeout(function () {\n    requestAnimationFrame(callback);\n  });\n}\n\nvar DraggableFlatList = function (_super) {\n  __extends(DraggableFlatList, _super);\n\n  function DraggableFlatList(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = {\n      activeKey: null,\n      hoverComponent: null\n    };\n    _this.containerRef = react_1.default.createRef();\n    _this.flatlistRef = react_1.default.createRef();\n    _this.panGestureHandlerRef = react_1.default.createRef();\n    _this.containerSize = new Value(0);\n    _this.activationDistance = new Value(0);\n    _this.touchAbsolute = new Value(0);\n    _this.touchCellOffset = new Value(0);\n    _this.panGestureState = new Value(react_native_gesture_handler_1.State.UNDETERMINED);\n    _this.isPressedIn = {\n      native: new Value(0),\n      js: false\n    };\n    _this.hasMoved = new Value(0);\n    _this.disabled = new Value(0);\n    _this.activeIndex = new Value(-1);\n    _this.isHovering = greaterThan(_this.activeIndex, -1);\n    _this.spacerIndex = new Value(-1);\n    _this.activeCellSize = new Value(0);\n    _this.scrollOffset = new Value(0);\n    _this.scrollViewSize = new Value(0);\n    _this.isScrolledUp = lessOrEq(sub(_this.scrollOffset, scrollPositionTolerance), 0);\n    _this.isScrolledDown = greaterOrEq(add(_this.scrollOffset, _this.containerSize, scrollPositionTolerance), _this.scrollViewSize);\n    _this.hoverAnimUnconstrained = sub(_this.touchAbsolute, _this.touchCellOffset);\n    _this.hoverAnimConstrained = min(sub(_this.containerSize, _this.activeCellSize), max(0, _this.hoverAnimUnconstrained));\n    _this.hoverAnim = _this.props.dragItemOverflow ? _this.hoverAnimUnconstrained : _this.hoverAnimConstrained;\n    _this.hoverMid = add(_this.hoverAnim, divide(_this.activeCellSize, 2));\n    _this.hoverOffset = add(_this.hoverAnim, _this.scrollOffset);\n    _this.placeholderOffset = new Value(0);\n    _this.placeholderPos = sub(_this.placeholderOffset, _this.scrollOffset);\n    _this.hoverTo = new Value(0);\n    _this.hoverClock = new Clock();\n    _this.hoverAnimState = {\n      finished: new Value(0),\n      velocity: new Value(0),\n      position: new Value(0),\n      time: new Value(0)\n    };\n    _this.hoverAnimConfig = __assign(__assign(__assign({}, defaultAnimationConfig), _this.props.animationConfig), {\n      toValue: _this.hoverTo\n    });\n    _this.distToTopEdge = max(0, _this.hoverAnim);\n    _this.distToBottomEdge = max(0, sub(_this.containerSize, add(_this.hoverAnim, _this.activeCellSize)));\n    _this.cellAnim = new Map();\n    _this.cellData = new Map();\n    _this.cellRefs = new Map();\n    _this.moveEndParams = [_this.activeIndex, _this.spacerIndex];\n    _this.resetHoverSpring = [set(_this.hoverAnimState.time, 0), set(_this.hoverAnimState.position, _this.hoverAnimConfig.toValue), set(_this.touchAbsolute, _this.hoverAnimConfig.toValue), set(_this.touchCellOffset, 0), set(_this.hoverAnimState.finished, 0), set(_this.hoverAnimState.velocity, 0), set(_this.hasMoved, 0)];\n    _this.keyToIndex = new Map();\n    _this.isAutoscrolling = {\n      native: new Value(0),\n      js: false\n    };\n    _this.queue = [];\n\n    _this.dataKeysHaveChanged = function (a, b) {\n      var lengthHasChanged = a.length !== b.length;\n      if (lengthHasChanged) return true;\n      var aKeys = a.map(function (d, i) {\n        return _this.keyExtractor(d, i);\n      });\n      var bKeys = b.map(function (d, i) {\n        return _this.keyExtractor(d, i);\n      });\n      var sameKeys = aKeys.every(function (k) {\n        return bKeys.includes(k);\n      });\n      return !sameKeys;\n    };\n\n    _this.componentDidUpdate = function (prevProps, prevState) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var layoutInvalidationKeyHasChanged, dataHasChanged, index, cellData;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          layoutInvalidationKeyHasChanged = prevProps.layoutInvalidationKey !== this.props.layoutInvalidationKey;\n          dataHasChanged = prevProps.data !== this.props.data;\n\n          if (layoutInvalidationKeyHasChanged || dataHasChanged) {\n            this.props.data.forEach(function (item, index) {\n              var key = _this.keyExtractor(item, index);\n\n              _this.keyToIndex.set(key, index);\n            });\n            this.updateCellData(this.props.data);\n            onNextFrame(this.flushQueue);\n\n            if (layoutInvalidationKeyHasChanged || this.dataKeysHaveChanged(prevProps.data, this.props.data)) {\n              this.queue.push(function () {\n                return _this.measureAll(_this.props.data);\n              });\n            }\n          }\n\n          if (!prevState.activeKey && this.state.activeKey) {\n            index = this.keyToIndex.get(this.state.activeKey);\n\n            if (index !== undefined) {\n              this.spacerIndex.setValue(index);\n              this.activeIndex.setValue(index);\n              this.touchCellOffset.setValue(0);\n              this.isPressedIn.native.setValue(1);\n            }\n\n            cellData = this.cellData.get(this.state.activeKey);\n\n            if (cellData) {\n              this.touchAbsolute.setValue(sub(cellData.offset, this.scrollOffset));\n              this.activeCellSize.setValue(cellData.measurements.size);\n            }\n          }\n\n          return [2];\n        });\n      });\n    };\n\n    _this.flushQueue = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          this.queue.forEach(function (fn) {\n            return fn();\n          });\n          this.queue = [];\n          return [2];\n        });\n      });\n    };\n\n    _this.resetHoverState = function () {\n      _this.activeIndex.setValue(-1);\n\n      _this.spacerIndex.setValue(-1);\n\n      _this.disabled.setValue(0);\n\n      if (_this.state.hoverComponent !== null || _this.state.activeKey !== null) {\n        _this.setState({\n          hoverComponent: null,\n          activeKey: null\n        });\n      }\n    };\n\n    _this.drag = function (hoverComponent, activeKey) {\n      if (_this.state.hoverComponent) {\n        if (_this.props.debug) console.log(\"## Can't set multiple active items\");\n      } else {\n        _this.isPressedIn.js = true;\n\n        _this.setState({\n          activeKey: activeKey,\n          hoverComponent: hoverComponent\n        }, function () {\n          var index = _this.keyToIndex.get(activeKey);\n\n          var onDragBegin = _this.props.onDragBegin;\n\n          if (index !== undefined && onDragBegin) {\n            onDragBegin(index);\n          }\n        });\n      }\n    };\n\n    _this.onRelease = function (_a) {\n      var index = _a[0];\n      var onRelease = _this.props.onRelease;\n      _this.isPressedIn.js = false;\n      onRelease && onRelease(index);\n    };\n\n    _this.onDragEnd = function (_a) {\n      var from = _a[0],\n          to = _a[1];\n      var onDragEnd = _this.props.onDragEnd;\n\n      if (onDragEnd) {\n        var data = _this.props.data;\n\n        var newData = __spreadArrays(data);\n\n        if (from !== to) {\n          newData.splice(from, 1);\n          newData.splice(to, 0, data[from]);\n        }\n\n        onDragEnd({\n          from: from,\n          to: to,\n          data: newData\n        });\n      }\n\n      var lo = Math.min(from, to) - 1;\n      var hi = Math.max(from, to) + 1;\n\n      var _loop_1 = function _loop_1(i) {\n        _this.queue.push(function () {\n          var item = _this.props.data[i];\n          if (!item) return;\n\n          var key = _this.keyExtractor(item, i);\n\n          return _this.measureCell(key);\n        });\n      };\n\n      for (var i = lo; i < hi; i++) {\n        _loop_1(i);\n      }\n\n      _this.resetHoverState();\n    };\n\n    _this.updateCellData = function (data) {\n      if (data === void 0) {\n        data = [];\n      }\n\n      return data.forEach(function (item, index) {\n        var key = _this.keyExtractor(item, index);\n\n        var cell = _this.cellData.get(key);\n\n        if (cell) cell.currentIndex.setValue(index);\n      });\n    };\n\n    _this.setCellData = function (key, index) {\n      var clock = new Clock();\n      var currentIndex = new Value(index);\n\n      var config = __assign(__assign({}, _this.hoverAnimConfig), {\n        toValue: new Value(0)\n      });\n\n      var state = {\n        position: new Value(0),\n        velocity: new Value(0),\n        time: new Value(0),\n        finished: new Value(0)\n      };\n\n      _this.cellAnim.set(key, {\n        clock: clock,\n        state: state,\n        config: config\n      });\n\n      var initialized = new Value(0);\n      var size = new Value(0);\n      var offset = new Value(0);\n      var isAfterActive = new Value(0);\n      var translate = new Value(0);\n      var runSrping = cond(clockRunning(clock), procs_1.springFill(clock, state, config));\n      var onHasMoved = startClock(clock);\n      var onChangeSpacerIndex = cond(clockRunning(clock), stopClock(clock));\n      var onFinished = stopClock(clock);\n      var prevTrans = new Value(0);\n      var prevSpacerIndex = new Value(-1);\n      var anim = procs_1.setupCell(currentIndex, initialized, size, offset, isAfterActive, translate, prevTrans, prevSpacerIndex, _this.activeIndex, _this.activeCellSize, _this.hoverOffset, _this.scrollOffset, _this.isHovering, _this.hoverTo, _this.hasMoved, _this.spacerIndex, config.toValue, state.position, state.time, state.finished, runSrping, onHasMoved, onChangeSpacerIndex, onFinished, _this.isPressedIn.native, _this.placeholderOffset);\n      var transform = _this.props.horizontal ? [{\n        translateX: anim\n      }] : [{\n        translateY: anim\n      }];\n      var style = {\n        transform: transform\n      };\n      var cellData = {\n        initialized: initialized,\n        currentIndex: currentIndex,\n        size: size,\n        offset: offset,\n        style: style,\n        onLayout: function onLayout() {\n          if (_this.state.activeKey !== key) _this.measureCell(key);\n        },\n        onUnmount: function onUnmount() {\n          return initialized.setValue(0);\n        },\n        measurements: {\n          size: 0,\n          offset: 0\n        }\n      };\n\n      _this.cellData.set(key, cellData);\n    };\n\n    _this.measureAll = function (data) {\n      data.forEach(function (d, i) {\n        var key = _this.keyExtractor(d, i);\n\n        _this.measureCell(key);\n      });\n    };\n\n    _this.measureCell = function (key) {\n      return new Promise(function (resolve, reject) {\n        var horizontal = _this.props.horizontal;\n\n        var onSuccess = function onSuccess(x, y, w, h) {\n          var activeKey = _this.state.activeKey;\n          var isHovering = activeKey !== null;\n\n          var cellData = _this.cellData.get(key);\n\n          var thisKeyIndex = _this.keyToIndex.get(key);\n\n          var activeKeyIndex = activeKey ? _this.keyToIndex.get(activeKey) : undefined;\n          var baseOffset = horizontal ? x : y;\n          var extraOffset = 0;\n\n          if (thisKeyIndex !== undefined && activeKeyIndex !== undefined && activeKey) {\n            var isAfterActive = thisKeyIndex > activeKeyIndex;\n\n            var activeCellData = _this.cellData.get(activeKey);\n\n            if (isHovering && isAfterActive && activeCellData) {\n              extraOffset = activeCellData.measurements.size;\n            }\n          }\n\n          var size = horizontal ? w : h;\n          var offset = baseOffset + extraOffset;\n          if (_this.props.debug) console.log(\"measure key \" + key + \": wdith \" + w + \" height \" + h + \" x \" + x + \" y \" + y + \" size \" + size + \" offset \" + offset);\n\n          if (cellData) {\n            cellData.size.setValue(size);\n            cellData.offset.setValue(offset);\n            cellData.measurements.size = size;\n            cellData.measurements.offset = offset;\n          }\n\n          if (isHovering) _this.queue.push(function () {\n            return _this.measureCell(key);\n          });\n          resolve();\n        };\n\n        var onFail = function onFail() {\n          if (_this.props.debug) console.log(\"## measureLayout fail!\", key);\n        };\n\n        var ref = _this.cellRefs.get(key);\n\n        var viewNode = ref && ref.current && ref.current.getNode();\n\n        var flatListNode = _this.flatlistRef.current && _this.flatlistRef.current.getNode();\n\n        if (viewNode && flatListNode) {\n          var nodeHandle = react_native_1.findNodeHandle(flatListNode);\n          if (nodeHandle) viewNode.measureLayout(nodeHandle, onSuccess, onFail);\n        } else {\n          var reason = !ref ? \"no ref\" : !flatListNode ? \"no flatlist node\" : \"invalid ref\";\n          if (_this.props.debug) console.log(\"## can't measure \" + key + \" reason: \" + reason);\n\n          _this.queue.push(function () {\n            return _this.measureCell(key);\n          });\n\n          return resolve();\n        }\n      });\n    };\n\n    _this.keyExtractor = function (item, index) {\n      if (_this.props.keyExtractor) return _this.props.keyExtractor(item, index);else throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\n    };\n\n    _this.onContainerLayout = function () {\n      var horizontal = _this.props.horizontal;\n      var containerRef = _this.containerRef.current;\n\n      if (containerRef) {\n        containerRef.getNode().measure(function (x, y, w, h) {\n          _this.containerSize.setValue(horizontal ? w : h);\n        });\n      }\n    };\n\n    _this.onListContentSizeChange = function (w, h) {\n      _this.scrollViewSize.setValue(_this.props.horizontal ? w : h);\n\n      if (_this.props.onContentSizeChange) _this.props.onContentSizeChange(w, h);\n    };\n\n    _this.targetScrollOffset = new Value(0);\n\n    _this.onAutoscrollComplete = function (params) {\n      _this.isAutoscrolling.js = false;\n      if (_this.resolveAutoscroll) _this.resolveAutoscroll(params);\n    };\n\n    _this.scrollToAsync = function (offset) {\n      return new Promise(function (resolve, reject) {\n        _this.resolveAutoscroll = resolve;\n\n        _this.targetScrollOffset.setValue(offset);\n\n        _this.isAutoscrolling.native.setValue(1);\n\n        _this.isAutoscrolling.js = true;\n        var flatlistRef = _this.flatlistRef.current;\n        if (flatlistRef) flatlistRef.getNode().scrollToOffset({\n          offset: offset\n        });\n      });\n    };\n\n    _this.getScrollTargetOffset = function (distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown) {\n      if (_this.isAutoscrolling.js) return -1;\n      var _a = _this.props,\n          autoscrollThreshold = _a.autoscrollThreshold,\n          autoscrollSpeed = _a.autoscrollSpeed;\n      var scrollUp = distFromTop < autoscrollThreshold;\n      var scrollDown = distFromBottom < autoscrollThreshold;\n      if (!(scrollUp || scrollDown) || scrollUp && isScrolledUp || scrollDown && isScrolledDown) return -1;\n      var distFromEdge = scrollUp ? distFromTop : distFromBottom;\n      var speedPct = 1 - distFromEdge / autoscrollThreshold;\n      var speed = react_native_1.Platform.OS === \"ios\" ? autoscrollSpeed : autoscrollSpeed / 10;\n      var offset = speedPct * speed;\n      var targetOffset = scrollUp ? Math.max(0, scrollOffset - offset) : scrollOffset + offset;\n      return targetOffset;\n    };\n\n    _this.autoscrollLooping = false;\n\n    _this.autoscroll = function (params) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var shouldScroll, curParams, distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown, targetOffset, scrollingUpAtTop, scrollingDownAtBottom;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (this.autoscrollLooping) {\n                return [2];\n              }\n\n              this.autoscrollLooping = true;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 6, 7]);\n\n              shouldScroll = true;\n              curParams = params;\n              _a.label = 2;\n\n            case 2:\n              if (!shouldScroll) return [3, 5];\n              distFromTop = curParams[0], distFromBottom = curParams[1], scrollOffset = curParams[2], isScrolledUp = curParams[3], isScrolledDown = curParams[4];\n              targetOffset = this.getScrollTargetOffset(distFromTop, distFromBottom, scrollOffset, !!isScrolledUp, !!isScrolledDown);\n              scrollingUpAtTop = !!(isScrolledUp && targetOffset <= scrollOffset);\n              scrollingDownAtBottom = !!(isScrolledDown && targetOffset >= scrollOffset);\n              shouldScroll = targetOffset >= 0 && this.isPressedIn.js && !scrollingUpAtTop && !scrollingDownAtBottom;\n              if (!shouldScroll) return [3, 4];\n              return [4, this.scrollToAsync(targetOffset)];\n\n            case 3:\n              curParams = _a.sent();\n              _a.label = 4;\n\n            case 4:\n              return [3, 2];\n\n            case 5:\n              return [3, 7];\n\n            case 6:\n              this.autoscrollLooping = false;\n              return [7];\n\n            case 7:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.isAtTopEdge = lessOrEq(_this.distToTopEdge, _this.props.autoscrollThreshold);\n    _this.isAtBottomEdge = lessOrEq(_this.distToBottomEdge, _this.props.autoscrollThreshold);\n    _this.isAtEdge = or(_this.isAtBottomEdge, _this.isAtTopEdge);\n    _this.autoscrollParams = [_this.distToTopEdge, _this.distToBottomEdge, _this.scrollOffset, _this.isScrolledUp, _this.isScrolledDown];\n    _this.checkAutoscroll = cond(and(_this.isAtEdge, not(and(_this.isAtTopEdge, _this.isScrolledUp)), not(and(_this.isAtBottomEdge, _this.isScrolledDown)), eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.isAutoscrolling.native)), call(_this.autoscrollParams, _this.autoscroll));\n    _this.onScroll = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var contentOffset = _a.contentOffset;\n        return block([set(_this.scrollOffset, _this.props.horizontal ? contentOffset.x : contentOffset.y), cond(and(_this.isAutoscrolling.native, or(lessOrEq(abs(sub(_this.targetScrollOffset, _this.scrollOffset)), scrollPositionTolerance), and(_this.isScrolledUp, lessOrEq(_this.targetScrollOffset, _this.scrollOffset)), and(_this.isScrolledDown, greaterOrEq(_this.targetScrollOffset, _this.scrollOffset)))), [set(_this.isAutoscrolling.native, 0), call(_this.autoscrollParams, _this.onAutoscrollComplete)])]);\n      }\n    }]);\n    _this.onGestureRelease = [cond(_this.isHovering, [set(_this.disabled, 1), cond(defined(_this.hoverClock), [cond(clockRunning(_this.hoverClock), stopClock(_this.hoverClock)), set(_this.hoverAnimState.position, _this.hoverAnim), startClock(_this.hoverClock)]), [call([_this.activeIndex], _this.onRelease), cond(not(_this.hasMoved), call([_this.activeIndex], _this.resetHoverState))]], call([_this.activeIndex], _this.resetHoverState))];\n    _this.onPanStateChange = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var state = _a.state,\n            x = _a.x,\n            y = _a.y;\n        return cond(and(neq(state, _this.panGestureState), not(_this.disabled)), [set(_this.panGestureState, state), cond(eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), set(_this.activationDistance, sub(_this.touchAbsolute, _this.props.horizontal ? x : y))), cond(or(eq(state, react_native_gesture_handler_1.State.END), eq(state, react_native_gesture_handler_1.State.CANCELLED), eq(state, react_native_gesture_handler_1.State.FAILED)), _this.onGestureRelease)]);\n      }\n    }]);\n    _this.onPanGestureEvent = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var x = _a.x,\n            y = _a.y;\n        return cond(and(_this.isHovering, eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.disabled)), [cond(not(_this.hasMoved), set(_this.hasMoved, 1)), set(_this.touchAbsolute, add(_this.props.horizontal ? x : y, _this.activationDistance))]);\n      }\n    }]);\n    _this.hoverComponentTranslate = cond(clockRunning(_this.hoverClock), _this.hoverAnimState.position, _this.hoverAnim);\n    _this.hoverComponentOpacity = and(_this.isHovering, neq(_this.panGestureState, react_native_gesture_handler_1.State.CANCELLED));\n\n    _this.renderHoverComponent = function () {\n      var _a;\n\n      var hoverComponent = _this.state.hoverComponent;\n      var horizontal = _this.props.horizontal;\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        style: [horizontal ? styles.hoverComponentHorizontal : styles.hoverComponentVertical, {\n          opacity: _this.hoverComponentOpacity,\n          transform: [(_a = {}, _a[\"translate\" + (horizontal ? \"X\" : \"Y\")] = _this.hoverComponentTranslate, _a)]\n        }]\n      }, hoverComponent);\n    };\n\n    _this.renderItem = function (_a) {\n      var item = _a.item,\n          index = _a.index;\n\n      var key = _this.keyExtractor(item, index);\n\n      if (index !== _this.keyToIndex.get(key)) _this.keyToIndex.set(key, index);\n      var renderItem = _this.props.renderItem;\n      if (!_this.cellData.get(key)) _this.setCellData(key, index);\n      var onUnmount = (_this.cellData.get(key) || {\n        onUnmount: function onUnmount() {\n          if (_this.props.debug) console.log(\"## error, no cellData\");\n        }\n      }).onUnmount;\n      return react_1.default.createElement(RowItem, {\n        extraData: _this.props.extraData,\n        itemKey: key,\n        keyToIndex: _this.keyToIndex,\n        renderItem: renderItem,\n        item: item,\n        drag: _this.drag,\n        onUnmount: onUnmount\n      });\n    };\n\n    _this.renderOnPlaceholderIndexChange = function () {\n      return react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n        return block([onChange(_this.spacerIndex, call([_this.spacerIndex], function (_a) {\n          var spacerIndex = _a[0];\n          return _this.props.onPlaceholderIndexChange(spacerIndex);\n        }))]);\n      });\n    };\n\n    _this.renderPlaceholder = function () {\n      var _a, _b;\n\n      var _c = _this.props,\n          renderPlaceholder = _c.renderPlaceholder,\n          horizontal = _c.horizontal;\n      var activeKey = _this.state.activeKey;\n      if (!activeKey || !renderPlaceholder) return null;\n\n      var activeIndex = _this.keyToIndex.get(activeKey);\n\n      if (activeIndex === undefined) return null;\n      var activeItem = _this.props.data[activeIndex];\n      var translateKey = horizontal ? \"translateX\" : \"translateY\";\n      var sizeKey = horizontal ? \"width\" : \"height\";\n\n      var style = __assign(__assign({}, react_native_1.StyleSheet.absoluteFillObject), (_a = {}, _a[sizeKey] = _this.activeCellSize, _a.transform = [(_b = {}, _b[translateKey] = _this.placeholderPos, _b)], _a));\n\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        style: style\n      }, renderPlaceholder({\n        item: activeItem,\n        index: activeIndex\n      }));\n    };\n\n    _this.CellRendererComponent = function (cellProps) {\n      var item = cellProps.item,\n          index = cellProps.index,\n          children = cellProps.children,\n          onLayout = cellProps.onLayout;\n      var horizontal = _this.props.horizontal;\n      var activeKey = _this.state.activeKey;\n\n      var key = _this.keyExtractor(item, index);\n\n      if (!_this.cellData.get(key)) _this.setCellData(key, index);\n\n      var cellData = _this.cellData.get(key);\n\n      if (!cellData) return null;\n      var style = cellData.style,\n          onCellLayout = cellData.onLayout;\n\n      var ref = _this.cellRefs.get(key);\n\n      if (!ref) {\n        ref = react_1.default.createRef();\n\n        _this.cellRefs.set(key, ref);\n      }\n\n      var isActiveCell = activeKey === key;\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        onLayout: onLayout,\n        style: style\n      }, react_1.default.createElement(react_native_reanimated_1.default.View, {\n        pointerEvents: activeKey ? \"none\" : \"auto\",\n        style: {\n          flexDirection: horizontal ? \"row\" : \"column\"\n        }\n      }, react_1.default.createElement(react_native_reanimated_1.default.View, {\n        ref: ref,\n        onLayout: onCellLayout,\n        style: isActiveCell ? {\n          opacity: 0\n        } : undefined\n      }, children)));\n    };\n\n    _this.onContainerTouchEnd = function () {\n      _this.isPressedIn.native.setValue(0);\n    };\n\n    var data = props.data,\n        onRef = props.onRef;\n    data.forEach(function (item, index) {\n      var key = _this.keyExtractor(item, index);\n\n      _this.keyToIndex.set(key, index);\n    });\n    onRef && onRef(_this.flatlistRef);\n    return _this;\n  }\n\n  DraggableFlatList.getDerivedStateFromProps = function (props) {\n    return {\n      extraData: props.extraData\n    };\n  };\n\n  DraggableFlatList.prototype.renderDebug = function () {\n    var _this = this;\n\n    return react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n      return block([onChange(_this.spacerIndex, debug(\"spacerIndex: \", _this.spacerIndex))]);\n    });\n  };\n\n  DraggableFlatList.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        dragHitSlop = _a.dragHitSlop,\n        scrollEnabled = _a.scrollEnabled,\n        debug = _a.debug,\n        horizontal = _a.horizontal,\n        activationDistance = _a.activationDistance,\n        onScrollOffsetChange = _a.onScrollOffsetChange,\n        renderPlaceholder = _a.renderPlaceholder,\n        onPlaceholderIndexChange = _a.onPlaceholderIndexChange;\n    var hoverComponent = this.state.hoverComponent;\n    var dynamicProps = {};\n\n    if (activationDistance) {\n      var activeOffset = [-activationDistance, activationDistance];\n      dynamicProps = horizontal ? {\n        activeOffsetX: activeOffset\n      } : {\n        activeOffsetY: activeOffset\n      };\n    }\n\n    return react_1.default.createElement(react_native_gesture_handler_1.PanGestureHandler, __assign({\n      ref: this.panGestureHandlerRef,\n      hitSlop: dragHitSlop,\n      onGestureEvent: this.onPanGestureEvent,\n      onHandlerStateChange: this.onPanStateChange\n    }, dynamicProps), react_1.default.createElement(react_native_reanimated_1.default.View, {\n      style: styles.flex,\n      ref: this.containerRef,\n      onLayout: this.onContainerLayout,\n      onTouchEnd: this.onContainerTouchEnd\n    }, !!onPlaceholderIndexChange && this.renderOnPlaceholderIndexChange(), !!renderPlaceholder && this.renderPlaceholder(), react_1.default.createElement(AnimatedFlatList, __assign({}, this.props, {\n      CellRendererComponent: this.CellRendererComponent,\n      ref: this.flatlistRef,\n      onContentSizeChange: this.onListContentSizeChange,\n      scrollEnabled: !hoverComponent && scrollEnabled,\n      renderItem: this.renderItem,\n      extraData: this.state,\n      keyExtractor: this.keyExtractor,\n      onScroll: this.onScroll,\n      scrollEventThrottle: 1\n    })), !!hoverComponent && this.renderHoverComponent(), react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n      return block([onChange(_this.isPressedIn.native, cond(not(_this.isPressedIn.native), _this.onGestureRelease)), onChange(_this.touchAbsolute, _this.checkAutoscroll), cond(clockRunning(_this.hoverClock), [spring(_this.hoverClock, _this.hoverAnimState, _this.hoverAnimConfig), cond(eq(_this.hoverAnimState.finished, 1), [stopClock(_this.hoverClock), call(_this.moveEndParams, _this.onDragEnd), _this.resetHoverSpring, set(_this.hasMoved, 0)])])]);\n    }), onScrollOffsetChange && react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n      return onChange(_this.scrollOffset, call([_this.scrollOffset], function (_a) {\n        var offset = _a[0];\n        return onScrollOffsetChange(offset);\n      }));\n    }), debug && this.renderDebug()));\n  };\n\n  DraggableFlatList.defaultProps = defaultProps;\n  return DraggableFlatList;\n}(react_1.default.Component);\n\nexports.default = DraggableFlatList;\n\nvar RowItem = function (_super) {\n  __extends(RowItem, _super);\n\n  function RowItem() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.drag = function () {\n      var _a = _this.props,\n          drag = _a.drag,\n          renderItem = _a.renderItem,\n          item = _a.item,\n          keyToIndex = _a.keyToIndex,\n          itemKey = _a.itemKey,\n          debug = _a.debug;\n      var hoverComponent = renderItem({\n        isActive: true,\n        item: item,\n        index: keyToIndex.get(itemKey),\n        drag: function drag() {\n          if (debug) console.log(\"## attempt to call drag() on hovering component\");\n        }\n      });\n      drag(hoverComponent, itemKey);\n    };\n\n    return _this;\n  }\n\n  RowItem.prototype.componentWillUnmount = function () {\n    this.props.onUnmount();\n  };\n\n  RowItem.prototype.render = function () {\n    var _a = this.props,\n        renderItem = _a.renderItem,\n        item = _a.item,\n        keyToIndex = _a.keyToIndex,\n        itemKey = _a.itemKey;\n    return renderItem({\n      isActive: false,\n      item: item,\n      index: keyToIndex.get(itemKey),\n      drag: this.drag\n    });\n  };\n\n  return RowItem;\n}(react_1.default.PureComponent);\n\nvar styles = react_native_1.StyleSheet.create({\n  flex: {\n    flex: 1\n  },\n  hoverComponentVertical: {\n    position: \"absolute\",\n    left: 0,\n    right: 0\n  },\n  hoverComponentHorizontal: {\n    position: \"absolute\",\n    bottom: 0,\n    top: 0\n  }\n});","map":{"version":3,"sources":["/Users/steveruiz/GitHub/play-rn-prototype/node_modules/react-native-draggable-flatlist/lib/index.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","__importDefault","mod","__esModule","defineProperty","exports","react_1","require","react_native_gesture_handler_1","react_native_reanimated_1","procs_1","AnimatedFlatList","default","createAnimatedComponent","FlatList","Value","abs","set","cond","add","sub","event","block","eq","neq","and","or","onChange","divide","greaterThan","greaterOrEq","lessOrEq","not","Clock","clockRunning","startClock","stopClock","spring","defined","min","max","debug","scrollPositionTolerance","defaultAnimationConfig","damping","mass","stiffness","overshootClamping","restSpeedThreshold","restDisplacementThreshold","defaultProps","autoscrollThreshold","autoscrollSpeed","animationConfig","scrollEnabled","dragHitSlop","activationDistance","dragItemOverflow","onNextFrame","callback","setTimeout","requestAnimationFrame","DraggableFlatList","_super","props","_this","state","activeKey","hoverComponent","containerRef","createRef","flatlistRef","panGestureHandlerRef","containerSize","touchAbsolute","touchCellOffset","panGestureState","State","UNDETERMINED","isPressedIn","native","js","hasMoved","disabled","activeIndex","isHovering","spacerIndex","activeCellSize","scrollOffset","scrollViewSize","isScrolledUp","isScrolledDown","hoverAnimUnconstrained","hoverAnimConstrained","hoverAnim","hoverMid","hoverOffset","placeholderOffset","placeholderPos","hoverTo","hoverClock","hoverAnimState","finished","velocity","position","time","hoverAnimConfig","toValue","distToTopEdge","distToBottomEdge","cellAnim","Map","cellData","cellRefs","moveEndParams","resetHoverSpring","keyToIndex","isAutoscrolling","queue","dataKeysHaveChanged","lengthHasChanged","aKeys","map","keyExtractor","bKeys","sameKeys","every","includes","componentDidUpdate","prevProps","prevState","layoutInvalidationKeyHasChanged","dataHasChanged","index","_a","layoutInvalidationKey","data","forEach","item","key","updateCellData","flushQueue","measureAll","get","undefined","setValue","offset","measurements","size","fn","resetHoverState","setState","drag","console","log","onDragBegin","onRelease","onDragEnd","from","to","newData","splice","lo","Math","hi","_loop_1","measureCell","cell","currentIndex","setCellData","clock","config","initialized","isAfterActive","translate","runSrping","springFill","onHasMoved","onChangeSpacerIndex","onFinished","prevTrans","prevSpacerIndex","anim","setupCell","transform","horizontal","translateX","translateY","style","onLayout","onUnmount","onSuccess","x","w","h","thisKeyIndex","activeKeyIndex","baseOffset","extraOffset","activeCellData","onFail","ref","viewNode","current","getNode","flatListNode","nodeHandle","react_native_1","findNodeHandle","measureLayout","reason","Error","onContainerLayout","measure","onListContentSizeChange","onContentSizeChange","targetScrollOffset","onAutoscrollComplete","params","resolveAutoscroll","scrollToAsync","scrollToOffset","getScrollTargetOffset","distFromTop","distFromBottom","scrollUp","scrollDown","distFromEdge","speedPct","speed","Platform","OS","targetOffset","autoscrollLooping","autoscroll","shouldScroll","curParams","scrollingUpAtTop","scrollingDownAtBottom","isAtTopEdge","isAtBottomEdge","isAtEdge","autoscrollParams","checkAutoscroll","ACTIVE","onScroll","nativeEvent","contentOffset","onGestureRelease","onPanStateChange","END","CANCELLED","FAILED","onPanGestureEvent","hoverComponentTranslate","hoverComponentOpacity","renderHoverComponent","createElement","View","styles","hoverComponentHorizontal","hoverComponentVertical","opacity","renderItem","RowItem","extraData","itemKey","renderOnPlaceholderIndexChange","Code","onPlaceholderIndexChange","renderPlaceholder","_b","_c","activeItem","translateKey","sizeKey","StyleSheet","absoluteFillObject","CellRendererComponent","cellProps","children","onCellLayout","isActiveCell","pointerEvents","flexDirection","onContainerTouchEnd","onRef","getDerivedStateFromProps","renderDebug","render","onScrollOffsetChange","dynamicProps","activeOffset","activeOffsetX","activeOffsetY","PanGestureHandler","hitSlop","onGestureEvent","onHandlerStateChange","flex","onTouchEnd","scrollEventThrottle","Component","isActive","componentWillUnmount","PureComponent","left","right","bottom","top"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importDefault(require(\"react\"));\nvar react_native_1 = require(\"react-native\");\nvar react_native_gesture_handler_1 = require(\"react-native-gesture-handler\");\nvar react_native_reanimated_1 = __importDefault(require(\"react-native-reanimated\"));\nvar procs_1 = require(\"./procs\");\nvar AnimatedFlatList = react_native_reanimated_1.default.createAnimatedComponent(react_native_gesture_handler_1.FlatList);\nvar Value = react_native_reanimated_1.default.Value, abs = react_native_reanimated_1.default.abs, set = react_native_reanimated_1.default.set, cond = react_native_reanimated_1.default.cond, add = react_native_reanimated_1.default.add, sub = react_native_reanimated_1.default.sub, event = react_native_reanimated_1.default.event, block = react_native_reanimated_1.default.block, eq = react_native_reanimated_1.default.eq, neq = react_native_reanimated_1.default.neq, and = react_native_reanimated_1.default.and, or = react_native_reanimated_1.default.or, call = react_native_reanimated_1.default.call, onChange = react_native_reanimated_1.default.onChange, divide = react_native_reanimated_1.default.divide, greaterThan = react_native_reanimated_1.default.greaterThan, greaterOrEq = react_native_reanimated_1.default.greaterOrEq, lessOrEq = react_native_reanimated_1.default.lessOrEq, not = react_native_reanimated_1.default.not, Clock = react_native_reanimated_1.default.Clock, clockRunning = react_native_reanimated_1.default.clockRunning, startClock = react_native_reanimated_1.default.startClock, stopClock = react_native_reanimated_1.default.stopClock, spring = react_native_reanimated_1.default.spring, defined = react_native_reanimated_1.default.defined, min = react_native_reanimated_1.default.min, max = react_native_reanimated_1.default.max, debug = react_native_reanimated_1.default.debug;\n// Fire onScrollComplete when within this many\n// px of target offset\nvar scrollPositionTolerance = 2;\nvar defaultAnimationConfig = {\n    damping: 20,\n    mass: 0.2,\n    stiffness: 100,\n    overshootClamping: false,\n    restSpeedThreshold: 0.2,\n    restDisplacementThreshold: 0.2\n};\nvar defaultProps = {\n    autoscrollThreshold: 30,\n    autoscrollSpeed: 100,\n    animationConfig: defaultAnimationConfig,\n    scrollEnabled: true,\n    dragHitSlop: 0,\n    activationDistance: 0,\n    dragItemOverflow: false\n};\n// Run callback on next paint:\n// https://stackoverflow.com/questions/26556436/react-after-render-code\nfunction onNextFrame(callback) {\n    setTimeout(function () {\n        requestAnimationFrame(callback);\n    });\n}\nvar DraggableFlatList = /** @class */ (function (_super) {\n    __extends(DraggableFlatList, _super);\n    function DraggableFlatList(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            activeKey: null,\n            hoverComponent: null\n        };\n        _this.containerRef = react_1.default.createRef();\n        _this.flatlistRef = react_1.default.createRef();\n        _this.panGestureHandlerRef = react_1.default.createRef();\n        _this.containerSize = new Value(0);\n        _this.activationDistance = new Value(0);\n        _this.touchAbsolute = new Value(0);\n        _this.touchCellOffset = new Value(0);\n        _this.panGestureState = new Value(react_native_gesture_handler_1.State.UNDETERMINED);\n        _this.isPressedIn = {\n            native: new Value(0),\n            js: false\n        };\n        _this.hasMoved = new Value(0);\n        _this.disabled = new Value(0);\n        _this.activeIndex = new Value(-1);\n        _this.isHovering = greaterThan(_this.activeIndex, -1);\n        _this.spacerIndex = new Value(-1);\n        _this.activeCellSize = new Value(0);\n        _this.scrollOffset = new Value(0);\n        _this.scrollViewSize = new Value(0);\n        _this.isScrolledUp = lessOrEq(sub(_this.scrollOffset, scrollPositionTolerance), 0);\n        _this.isScrolledDown = greaterOrEq(add(_this.scrollOffset, _this.containerSize, scrollPositionTolerance), _this.scrollViewSize);\n        _this.hoverAnimUnconstrained = sub(_this.touchAbsolute, _this.touchCellOffset);\n        _this.hoverAnimConstrained = min(sub(_this.containerSize, _this.activeCellSize), max(0, _this.hoverAnimUnconstrained));\n        _this.hoverAnim = _this.props.dragItemOverflow\n            ? _this.hoverAnimUnconstrained\n            : _this.hoverAnimConstrained;\n        _this.hoverMid = add(_this.hoverAnim, divide(_this.activeCellSize, 2));\n        _this.hoverOffset = add(_this.hoverAnim, _this.scrollOffset);\n        _this.placeholderOffset = new Value(0);\n        _this.placeholderPos = sub(_this.placeholderOffset, _this.scrollOffset);\n        _this.hoverTo = new Value(0);\n        _this.hoverClock = new Clock();\n        _this.hoverAnimState = {\n            finished: new Value(0),\n            velocity: new Value(0),\n            position: new Value(0),\n            time: new Value(0)\n        };\n        _this.hoverAnimConfig = __assign(__assign(__assign({}, defaultAnimationConfig), _this.props.animationConfig), { toValue: _this.hoverTo });\n        _this.distToTopEdge = max(0, _this.hoverAnim);\n        _this.distToBottomEdge = max(0, sub(_this.containerSize, add(_this.hoverAnim, _this.activeCellSize)));\n        _this.cellAnim = new Map();\n        _this.cellData = new Map();\n        _this.cellRefs = new Map();\n        _this.moveEndParams = [_this.activeIndex, _this.spacerIndex];\n        _this.resetHoverSpring = [\n            set(_this.hoverAnimState.time, 0),\n            set(_this.hoverAnimState.position, _this.hoverAnimConfig.toValue),\n            set(_this.touchAbsolute, _this.hoverAnimConfig.toValue),\n            set(_this.touchCellOffset, 0),\n            set(_this.hoverAnimState.finished, 0),\n            set(_this.hoverAnimState.velocity, 0),\n            set(_this.hasMoved, 0)\n        ];\n        _this.keyToIndex = new Map();\n        /** Whether we've sent an incomplete call to the FlatList to do a scroll */\n        _this.isAutoscrolling = {\n            native: new Value(0),\n            js: false\n        };\n        _this.queue = [];\n        _this.dataKeysHaveChanged = function (a, b) {\n            var lengthHasChanged = a.length !== b.length;\n            if (lengthHasChanged)\n                return true;\n            var aKeys = a.map(function (d, i) { return _this.keyExtractor(d, i); });\n            var bKeys = b.map(function (d, i) { return _this.keyExtractor(d, i); });\n            var sameKeys = aKeys.every(function (k) { return bKeys.includes(k); });\n            return !sameKeys;\n        };\n        _this.componentDidUpdate = function (prevProps, prevState) { return __awaiter(_this, void 0, void 0, function () {\n            var layoutInvalidationKeyHasChanged, dataHasChanged, index, cellData;\n            var _this = this;\n            return __generator(this, function (_a) {\n                layoutInvalidationKeyHasChanged = prevProps.layoutInvalidationKey !== this.props.layoutInvalidationKey;\n                dataHasChanged = prevProps.data !== this.props.data;\n                if (layoutInvalidationKeyHasChanged || dataHasChanged) {\n                    this.props.data.forEach(function (item, index) {\n                        var key = _this.keyExtractor(item, index);\n                        _this.keyToIndex.set(key, index);\n                    });\n                    // Remeasure on next paint\n                    this.updateCellData(this.props.data);\n                    onNextFrame(this.flushQueue);\n                    if (layoutInvalidationKeyHasChanged ||\n                        this.dataKeysHaveChanged(prevProps.data, this.props.data)) {\n                        this.queue.push(function () { return _this.measureAll(_this.props.data); });\n                    }\n                }\n                if (!prevState.activeKey && this.state.activeKey) {\n                    index = this.keyToIndex.get(this.state.activeKey);\n                    if (index !== undefined) {\n                        this.spacerIndex.setValue(index);\n                        this.activeIndex.setValue(index);\n                        this.touchCellOffset.setValue(0);\n                        this.isPressedIn.native.setValue(1);\n                    }\n                    cellData = this.cellData.get(this.state.activeKey);\n                    if (cellData) {\n                        this.touchAbsolute.setValue(sub(cellData.offset, this.scrollOffset));\n                        this.activeCellSize.setValue(cellData.measurements.size);\n                    }\n                }\n                return [2 /*return*/];\n            });\n        }); };\n        _this.flushQueue = function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.queue.forEach(function (fn) { return fn(); });\n                this.queue = [];\n                return [2 /*return*/];\n            });\n        }); };\n        _this.resetHoverState = function () {\n            _this.activeIndex.setValue(-1);\n            _this.spacerIndex.setValue(-1);\n            _this.disabled.setValue(0);\n            if (_this.state.hoverComponent !== null || _this.state.activeKey !== null) {\n                _this.setState({\n                    hoverComponent: null,\n                    activeKey: null\n                });\n            }\n        };\n        _this.drag = function (hoverComponent, activeKey) {\n            if (_this.state.hoverComponent) {\n                // We can't drag more than one row at a time\n                // TODO: Put action on queue?\n                if (_this.props.debug)\n                    console.log(\"## Can't set multiple active items\");\n            }\n            else {\n                _this.isPressedIn.js = true;\n                _this.setState({\n                    activeKey: activeKey,\n                    hoverComponent: hoverComponent\n                }, function () {\n                    var index = _this.keyToIndex.get(activeKey);\n                    var onDragBegin = _this.props.onDragBegin;\n                    if (index !== undefined && onDragBegin) {\n                        onDragBegin(index);\n                    }\n                });\n            }\n        };\n        _this.onRelease = function (_a) {\n            var index = _a[0];\n            var onRelease = _this.props.onRelease;\n            _this.isPressedIn.js = false;\n            onRelease && onRelease(index);\n        };\n        _this.onDragEnd = function (_a) {\n            var from = _a[0], to = _a[1];\n            var onDragEnd = _this.props.onDragEnd;\n            if (onDragEnd) {\n                var data = _this.props.data;\n                var newData = __spreadArrays(data);\n                if (from !== to) {\n                    newData.splice(from, 1);\n                    newData.splice(to, 0, data[from]);\n                }\n                onDragEnd({ from: from, to: to, data: newData });\n            }\n            var lo = Math.min(from, to) - 1;\n            var hi = Math.max(from, to) + 1;\n            var _loop_1 = function (i) {\n                _this.queue.push(function () {\n                    var item = _this.props.data[i];\n                    if (!item)\n                        return;\n                    var key = _this.keyExtractor(item, i);\n                    return _this.measureCell(key);\n                });\n            };\n            for (var i = lo; i < hi; i++) {\n                _loop_1(i);\n            }\n            _this.resetHoverState();\n        };\n        _this.updateCellData = function (data) {\n            if (data === void 0) { data = []; }\n            return data.forEach(function (item, index) {\n                var key = _this.keyExtractor(item, index);\n                var cell = _this.cellData.get(key);\n                if (cell)\n                    cell.currentIndex.setValue(index);\n            });\n        };\n        _this.setCellData = function (key, index) {\n            var clock = new Clock();\n            var currentIndex = new Value(index);\n            var config = __assign(__assign({}, _this.hoverAnimConfig), { toValue: new Value(0) });\n            var state = {\n                position: new Value(0),\n                velocity: new Value(0),\n                time: new Value(0),\n                finished: new Value(0)\n            };\n            _this.cellAnim.set(key, { clock: clock, state: state, config: config });\n            var initialized = new Value(0);\n            var size = new Value(0);\n            var offset = new Value(0);\n            var isAfterActive = new Value(0);\n            var translate = new Value(0);\n            var runSrping = cond(clockRunning(clock), procs_1.springFill(clock, state, config));\n            var onHasMoved = startClock(clock);\n            var onChangeSpacerIndex = cond(clockRunning(clock), stopClock(clock));\n            var onFinished = stopClock(clock);\n            var prevTrans = new Value(0);\n            var prevSpacerIndex = new Value(-1);\n            var anim = procs_1.setupCell(currentIndex, initialized, size, offset, isAfterActive, translate, prevTrans, prevSpacerIndex, _this.activeIndex, _this.activeCellSize, _this.hoverOffset, _this.scrollOffset, _this.isHovering, _this.hoverTo, _this.hasMoved, _this.spacerIndex, config.toValue, state.position, state.time, state.finished, runSrping, onHasMoved, onChangeSpacerIndex, onFinished, _this.isPressedIn.native, _this.placeholderOffset);\n            var transform = _this.props.horizontal\n                ? [{ translateX: anim }]\n                : [{ translateY: anim }];\n            var style = {\n                transform: transform\n            };\n            var cellData = {\n                initialized: initialized,\n                currentIndex: currentIndex,\n                size: size,\n                offset: offset,\n                style: style,\n                onLayout: function () {\n                    if (_this.state.activeKey !== key)\n                        _this.measureCell(key);\n                },\n                onUnmount: function () { return initialized.setValue(0); },\n                measurements: {\n                    size: 0,\n                    offset: 0\n                }\n            };\n            _this.cellData.set(key, cellData);\n        };\n        _this.measureAll = function (data) {\n            data.forEach(function (d, i) {\n                var key = _this.keyExtractor(d, i);\n                _this.measureCell(key);\n            });\n        };\n        _this.measureCell = function (key) {\n            return new Promise(function (resolve, reject) {\n                var horizontal = _this.props.horizontal;\n                var onSuccess = function (x, y, w, h) {\n                    var activeKey = _this.state.activeKey;\n                    var isHovering = activeKey !== null;\n                    var cellData = _this.cellData.get(key);\n                    var thisKeyIndex = _this.keyToIndex.get(key);\n                    var activeKeyIndex = activeKey\n                        ? _this.keyToIndex.get(activeKey)\n                        : undefined;\n                    var baseOffset = horizontal ? x : y;\n                    var extraOffset = 0;\n                    if (thisKeyIndex !== undefined &&\n                        activeKeyIndex !== undefined &&\n                        activeKey) {\n                        var isAfterActive = thisKeyIndex > activeKeyIndex;\n                        var activeCellData = _this.cellData.get(activeKey);\n                        if (isHovering && isAfterActive && activeCellData) {\n                            extraOffset = activeCellData.measurements.size;\n                        }\n                    }\n                    var size = horizontal ? w : h;\n                    var offset = baseOffset + extraOffset;\n                    if (_this.props.debug)\n                        console.log(\"measure key \" + key + \": wdith \" + w + \" height \" + h + \" x \" + x + \" y \" + y + \" size \" + size + \" offset \" + offset);\n                    if (cellData) {\n                        cellData.size.setValue(size);\n                        cellData.offset.setValue(offset);\n                        cellData.measurements.size = size;\n                        cellData.measurements.offset = offset;\n                    }\n                    // remeasure on next layout if hovering\n                    if (isHovering)\n                        _this.queue.push(function () { return _this.measureCell(key); });\n                    resolve();\n                };\n                var onFail = function () {\n                    if (_this.props.debug)\n                        console.log(\"## measureLayout fail!\", key);\n                };\n                var ref = _this.cellRefs.get(key);\n                var viewNode = ref && ref.current && ref.current.getNode();\n                var flatListNode = _this.flatlistRef.current && _this.flatlistRef.current.getNode();\n                if (viewNode && flatListNode) {\n                    var nodeHandle = react_native_1.findNodeHandle(flatListNode);\n                    if (nodeHandle)\n                        viewNode.measureLayout(nodeHandle, onSuccess, onFail);\n                }\n                else {\n                    var reason = !ref\n                        ? \"no ref\"\n                        : !flatListNode\n                            ? \"no flatlist node\"\n                            : \"invalid ref\";\n                    if (_this.props.debug)\n                        console.log(\"## can't measure \" + key + \" reason: \" + reason);\n                    _this.queue.push(function () { return _this.measureCell(key); });\n                    return resolve();\n                }\n            });\n        };\n        _this.keyExtractor = function (item, index) {\n            if (_this.props.keyExtractor)\n                return _this.props.keyExtractor(item, index);\n            else\n                throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\n        };\n        _this.onContainerLayout = function () {\n            var horizontal = _this.props.horizontal;\n            var containerRef = _this.containerRef.current;\n            if (containerRef) {\n                containerRef.getNode().measure(function (x, y, w, h) {\n                    _this.containerSize.setValue(horizontal ? w : h);\n                });\n            }\n        };\n        _this.onListContentSizeChange = function (w, h) {\n            _this.scrollViewSize.setValue(_this.props.horizontal ? w : h);\n            if (_this.props.onContentSizeChange)\n                _this.props.onContentSizeChange(w, h);\n        };\n        _this.targetScrollOffset = new Value(0);\n        _this.onAutoscrollComplete = function (params) {\n            _this.isAutoscrolling.js = false;\n            if (_this.resolveAutoscroll)\n                _this.resolveAutoscroll(params);\n        };\n        _this.scrollToAsync = function (offset) {\n            return new Promise(function (resolve, reject) {\n                _this.resolveAutoscroll = resolve;\n                _this.targetScrollOffset.setValue(offset);\n                _this.isAutoscrolling.native.setValue(1);\n                _this.isAutoscrolling.js = true;\n                var flatlistRef = _this.flatlistRef.current;\n                if (flatlistRef)\n                    flatlistRef.getNode().scrollToOffset({ offset: offset });\n            });\n        };\n        _this.getScrollTargetOffset = function (distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown) {\n            if (_this.isAutoscrolling.js)\n                return -1;\n            var _a = _this.props, autoscrollThreshold = _a.autoscrollThreshold, autoscrollSpeed = _a.autoscrollSpeed;\n            var scrollUp = distFromTop < autoscrollThreshold;\n            var scrollDown = distFromBottom < autoscrollThreshold;\n            if (!(scrollUp || scrollDown) ||\n                (scrollUp && isScrolledUp) ||\n                (scrollDown && isScrolledDown))\n                return -1;\n            var distFromEdge = scrollUp ? distFromTop : distFromBottom;\n            var speedPct = 1 - distFromEdge / autoscrollThreshold;\n            // Android scroll speed seems much faster than ios\n            var speed = react_native_1.Platform.OS === \"ios\" ? autoscrollSpeed : autoscrollSpeed / 10;\n            var offset = speedPct * speed;\n            var targetOffset = scrollUp\n                ? Math.max(0, scrollOffset - offset)\n                : scrollOffset + offset;\n            return targetOffset;\n        };\n        /** Ensure that only 1 call to autoscroll is active at a time */\n        _this.autoscrollLooping = false;\n        _this.autoscroll = function (params) { return __awaiter(_this, void 0, void 0, function () {\n            var shouldScroll, curParams, distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown, targetOffset, scrollingUpAtTop, scrollingDownAtBottom;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.autoscrollLooping) {\n                            return [2 /*return*/];\n                        }\n                        this.autoscrollLooping = true;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, , 6, 7]);\n                        shouldScroll = true;\n                        curParams = params;\n                        _a.label = 2;\n                    case 2:\n                        if (!shouldScroll) return [3 /*break*/, 5];\n                        distFromTop = curParams[0], distFromBottom = curParams[1], scrollOffset = curParams[2], isScrolledUp = curParams[3], isScrolledDown = curParams[4];\n                        targetOffset = this.getScrollTargetOffset(distFromTop, distFromBottom, scrollOffset, !!isScrolledUp, !!isScrolledDown);\n                        scrollingUpAtTop = !!(isScrolledUp && targetOffset <= scrollOffset);\n                        scrollingDownAtBottom = !!(isScrolledDown && targetOffset >= scrollOffset);\n                        shouldScroll =\n                            targetOffset >= 0 &&\n                                this.isPressedIn.js &&\n                                !scrollingUpAtTop &&\n                                !scrollingDownAtBottom;\n                        if (!shouldScroll) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.scrollToAsync(targetOffset)];\n                    case 3:\n                        curParams = _a.sent();\n                        _a.label = 4;\n                    case 4: return [3 /*break*/, 2];\n                    case 5: return [3 /*break*/, 7];\n                    case 6:\n                        this.autoscrollLooping = false;\n                        return [7 /*endfinally*/];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.isAtTopEdge = lessOrEq(_this.distToTopEdge, _this.props.autoscrollThreshold);\n        _this.isAtBottomEdge = lessOrEq(_this.distToBottomEdge, _this.props.autoscrollThreshold);\n        _this.isAtEdge = or(_this.isAtBottomEdge, _this.isAtTopEdge);\n        _this.autoscrollParams = [\n            _this.distToTopEdge,\n            _this.distToBottomEdge,\n            _this.scrollOffset,\n            _this.isScrolledUp,\n            _this.isScrolledDown\n        ];\n        _this.checkAutoscroll = cond(and(_this.isAtEdge, not(and(_this.isAtTopEdge, _this.isScrolledUp)), not(and(_this.isAtBottomEdge, _this.isScrolledDown)), eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.isAutoscrolling.native)), call(_this.autoscrollParams, _this.autoscroll));\n        _this.onScroll = event([\n            {\n                nativeEvent: function (_a) {\n                    var contentOffset = _a.contentOffset;\n                    return block([\n                        set(_this.scrollOffset, _this.props.horizontal ? contentOffset.x : contentOffset.y),\n                        cond(and(_this.isAutoscrolling.native, or(\n                        // We've scrolled to where we want to be\n                        lessOrEq(abs(sub(_this.targetScrollOffset, _this.scrollOffset)), scrollPositionTolerance), \n                        // We're at the start, but still want to scroll farther up\n                        and(_this.isScrolledUp, lessOrEq(_this.targetScrollOffset, _this.scrollOffset)), \n                        // We're at the end, but still want to scroll further down\n                        and(_this.isScrolledDown, greaterOrEq(_this.targetScrollOffset, _this.scrollOffset)))), [\n                            // Finish scrolling\n                            set(_this.isAutoscrolling.native, 0),\n                            call(_this.autoscrollParams, _this.onAutoscrollComplete)\n                        ])\n                    ]);\n                }\n            }\n        ]);\n        _this.onGestureRelease = [\n            cond(_this.isHovering, [\n                set(_this.disabled, 1),\n                cond(defined(_this.hoverClock), [\n                    cond(clockRunning(_this.hoverClock), stopClock(_this.hoverClock)),\n                    set(_this.hoverAnimState.position, _this.hoverAnim),\n                    startClock(_this.hoverClock)\n                ]),\n                [\n                    call([_this.activeIndex], _this.onRelease),\n                    cond(not(_this.hasMoved), call([_this.activeIndex], _this.resetHoverState))\n                ]\n            ], call([_this.activeIndex], _this.resetHoverState))\n        ];\n        _this.onPanStateChange = event([\n            {\n                nativeEvent: function (_a) {\n                    var state = _a.state, x = _a.x, y = _a.y;\n                    return cond(and(neq(state, _this.panGestureState), not(_this.disabled)), [\n                        set(_this.panGestureState, state),\n                        cond(eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), set(_this.activationDistance, sub(_this.touchAbsolute, _this.props.horizontal ? x : y))),\n                        cond(or(eq(state, react_native_gesture_handler_1.State.END), eq(state, react_native_gesture_handler_1.State.CANCELLED), eq(state, react_native_gesture_handler_1.State.FAILED)), _this.onGestureRelease)\n                    ]);\n                }\n            }\n        ]);\n        _this.onPanGestureEvent = event([\n            {\n                nativeEvent: function (_a) {\n                    var x = _a.x, y = _a.y;\n                    return cond(and(_this.isHovering, eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.disabled)), [\n                        cond(not(_this.hasMoved), set(_this.hasMoved, 1)),\n                        set(_this.touchAbsolute, add(_this.props.horizontal ? x : y, _this.activationDistance))\n                    ]);\n                }\n            }\n        ]);\n        _this.hoverComponentTranslate = cond(clockRunning(_this.hoverClock), _this.hoverAnimState.position, _this.hoverAnim);\n        _this.hoverComponentOpacity = and(_this.isHovering, neq(_this.panGestureState, react_native_gesture_handler_1.State.CANCELLED));\n        _this.renderHoverComponent = function () {\n            var _a;\n            var hoverComponent = _this.state.hoverComponent;\n            var horizontal = _this.props.horizontal;\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { style: [\n                    horizontal\n                        ? styles.hoverComponentHorizontal\n                        : styles.hoverComponentVertical,\n                    {\n                        opacity: _this.hoverComponentOpacity,\n                        transform: [\n                            (_a = {},\n                                _a[\"translate\" + (horizontal ? \"X\" : \"Y\")] = _this\n                                    .hoverComponentTranslate,\n                                _a)\n                        ]\n                    }\n                ] }, hoverComponent));\n        };\n        _this.renderItem = function (_a) {\n            var item = _a.item, index = _a.index;\n            var key = _this.keyExtractor(item, index);\n            if (index !== _this.keyToIndex.get(key))\n                _this.keyToIndex.set(key, index);\n            var renderItem = _this.props.renderItem;\n            if (!_this.cellData.get(key))\n                _this.setCellData(key, index);\n            var onUnmount = (_this.cellData.get(key) || {\n                onUnmount: function () {\n                    if (_this.props.debug)\n                        console.log(\"## error, no cellData\");\n                }\n            }).onUnmount;\n            return (react_1.default.createElement(RowItem, { extraData: _this.props.extraData, itemKey: key, keyToIndex: _this.keyToIndex, renderItem: renderItem, item: item, drag: _this.drag, onUnmount: onUnmount }));\n        };\n        _this.renderOnPlaceholderIndexChange = function () { return (react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n            return block([\n                onChange(_this.spacerIndex, call([_this.spacerIndex], function (_a) {\n                    var spacerIndex = _a[0];\n                    return _this.props.onPlaceholderIndexChange(spacerIndex);\n                }))\n            ]);\n        })); };\n        _this.renderPlaceholder = function () {\n            var _a, _b;\n            var _c = _this.props, renderPlaceholder = _c.renderPlaceholder, horizontal = _c.horizontal;\n            var activeKey = _this.state.activeKey;\n            if (!activeKey || !renderPlaceholder)\n                return null;\n            var activeIndex = _this.keyToIndex.get(activeKey);\n            if (activeIndex === undefined)\n                return null;\n            var activeItem = _this.props.data[activeIndex];\n            var translateKey = horizontal ? \"translateX\" : \"translateY\";\n            var sizeKey = horizontal ? \"width\" : \"height\";\n            var style = __assign(__assign({}, react_native_1.StyleSheet.absoluteFillObject), (_a = {}, _a[sizeKey] = _this.activeCellSize, _a.transform = [\n                (_b = {}, _b[translateKey] = _this.placeholderPos, _b)\n            ], _a));\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { style: style }, renderPlaceholder({ item: activeItem, index: activeIndex })));\n        };\n        _this.CellRendererComponent = function (cellProps) {\n            var item = cellProps.item, index = cellProps.index, children = cellProps.children, onLayout = cellProps.onLayout;\n            var horizontal = _this.props.horizontal;\n            var activeKey = _this.state.activeKey;\n            var key = _this.keyExtractor(item, index);\n            if (!_this.cellData.get(key))\n                _this.setCellData(key, index);\n            var cellData = _this.cellData.get(key);\n            if (!cellData)\n                return null;\n            var style = cellData.style, onCellLayout = cellData.onLayout;\n            var ref = _this.cellRefs.get(key);\n            if (!ref) {\n                ref = react_1.default.createRef();\n                _this.cellRefs.set(key, ref);\n            }\n            var isActiveCell = activeKey === key;\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { onLayout: onLayout, style: style },\n                react_1.default.createElement(react_native_reanimated_1.default.View, { pointerEvents: activeKey ? \"none\" : \"auto\", style: {\n                        flexDirection: horizontal ? \"row\" : \"column\"\n                    } },\n                    react_1.default.createElement(react_native_reanimated_1.default.View, { ref: ref, onLayout: onCellLayout, style: isActiveCell ? { opacity: 0 } : undefined }, children))));\n        };\n        _this.onContainerTouchEnd = function () {\n            _this.isPressedIn.native.setValue(0);\n        };\n        var data = props.data, onRef = props.onRef;\n        data.forEach(function (item, index) {\n            var key = _this.keyExtractor(item, index);\n            _this.keyToIndex.set(key, index);\n        });\n        onRef && onRef(_this.flatlistRef);\n        return _this;\n    }\n    DraggableFlatList.getDerivedStateFromProps = function (props) {\n        return {\n            extraData: props.extraData\n        };\n    };\n    DraggableFlatList.prototype.renderDebug = function () {\n        var _this = this;\n        return (react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n            return block([\n                onChange(_this.spacerIndex, debug(\"spacerIndex: \", _this.spacerIndex))\n            ]);\n        }));\n    };\n    DraggableFlatList.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, dragHitSlop = _a.dragHitSlop, scrollEnabled = _a.scrollEnabled, debug = _a.debug, horizontal = _a.horizontal, activationDistance = _a.activationDistance, onScrollOffsetChange = _a.onScrollOffsetChange, renderPlaceholder = _a.renderPlaceholder, onPlaceholderIndexChange = _a.onPlaceholderIndexChange;\n        var hoverComponent = this.state.hoverComponent;\n        var dynamicProps = {};\n        if (activationDistance) {\n            var activeOffset = [-activationDistance, activationDistance];\n            dynamicProps = horizontal\n                ? { activeOffsetX: activeOffset }\n                : { activeOffsetY: activeOffset };\n        }\n        return (react_1.default.createElement(react_native_gesture_handler_1.PanGestureHandler, __assign({ ref: this.panGestureHandlerRef, hitSlop: dragHitSlop, onGestureEvent: this.onPanGestureEvent, onHandlerStateChange: this.onPanStateChange }, dynamicProps),\n            react_1.default.createElement(react_native_reanimated_1.default.View, { style: styles.flex, ref: this.containerRef, onLayout: this.onContainerLayout, onTouchEnd: this.onContainerTouchEnd },\n                !!onPlaceholderIndexChange && this.renderOnPlaceholderIndexChange(),\n                !!renderPlaceholder && this.renderPlaceholder(),\n                react_1.default.createElement(AnimatedFlatList, __assign({}, this.props, { CellRendererComponent: this.CellRendererComponent, ref: this.flatlistRef, onContentSizeChange: this.onListContentSizeChange, scrollEnabled: !hoverComponent && scrollEnabled, renderItem: this.renderItem, extraData: this.state, keyExtractor: this.keyExtractor, onScroll: this.onScroll, scrollEventThrottle: 1 })),\n                !!hoverComponent && this.renderHoverComponent(),\n                react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n                    return block([\n                        onChange(_this.isPressedIn.native, cond(not(_this.isPressedIn.native), _this.onGestureRelease)),\n                        onChange(_this.touchAbsolute, _this.checkAutoscroll),\n                        cond(clockRunning(_this.hoverClock), [\n                            spring(_this.hoverClock, _this.hoverAnimState, _this.hoverAnimConfig),\n                            cond(eq(_this.hoverAnimState.finished, 1), [\n                                stopClock(_this.hoverClock),\n                                call(_this.moveEndParams, _this.onDragEnd),\n                                _this.resetHoverSpring,\n                                set(_this.hasMoved, 0)\n                            ])\n                        ])\n                    ]);\n                }),\n                onScrollOffsetChange && (react_1.default.createElement(react_native_reanimated_1.default.Code, null, function () {\n                    return onChange(_this.scrollOffset, call([_this.scrollOffset], function (_a) {\n                        var offset = _a[0];\n                        return onScrollOffsetChange(offset);\n                    }));\n                })),\n                debug && this.renderDebug())));\n    };\n    DraggableFlatList.defaultProps = defaultProps;\n    return DraggableFlatList;\n}(react_1.default.Component));\nexports.default = DraggableFlatList;\nvar RowItem = /** @class */ (function (_super) {\n    __extends(RowItem, _super);\n    function RowItem() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.drag = function () {\n            var _a = _this.props, drag = _a.drag, renderItem = _a.renderItem, item = _a.item, keyToIndex = _a.keyToIndex, itemKey = _a.itemKey, debug = _a.debug;\n            var hoverComponent = renderItem({\n                isActive: true,\n                item: item,\n                index: keyToIndex.get(itemKey),\n                drag: function () {\n                    if (debug)\n                        console.log(\"## attempt to call drag() on hovering component\");\n                }\n            });\n            drag(hoverComponent, itemKey);\n        };\n        return _this;\n    }\n    RowItem.prototype.componentWillUnmount = function () {\n        this.props.onUnmount();\n    };\n    RowItem.prototype.render = function () {\n        var _a = this.props, renderItem = _a.renderItem, item = _a.item, keyToIndex = _a.keyToIndex, itemKey = _a.itemKey;\n        return renderItem({\n            isActive: false,\n            item: item,\n            index: keyToIndex.get(itemKey),\n            drag: this.drag\n        });\n    };\n    return RowItem;\n}(react_1.default.PureComponent));\nvar styles = react_native_1.StyleSheet.create({\n    flex: {\n        flex: 1\n    },\n    hoverComponentVertical: {\n        position: \"absolute\",\n        left: 0,\n        right: 0\n    },\n    hoverComponentHorizontal: {\n        position: \"absolute\",\n        bottom: 0,\n        top: 0\n    }\n});\n"]},"metadata":{},"sourceType":"script"}